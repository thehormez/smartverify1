<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hormez â€” ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¯Ø¹ÙˆØ§Øª</title>
  <style>
    :root{--bg:#0b0f1a;--ink:#e8edf4;--muted:#9aa4b2;--line:#273043;--card:#0f1524;--accent:#ffd24a;--ok:#16a34a;--bad:#dc2626;--warn:#f59e0b}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b0f1a,#0a0f1d);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:14px}
    .btn{appearance:none;border:1px solid var(--line);background:#0b1220;color:var(--ink);border-radius:10px;padding:10px 14px;cursor:pointer}
    .btn:hover{background:#0d1528}
    .btn-cta{background:linear-gradient(135deg,var(--accent),#ffe494);color:#0a0a0a;border:none;font-weight:800}
    .select,.input,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--ink)}
    .muted{color:var(--muted)}
    .grid{display:grid;gap:12px}
    .grid-3{grid-template-columns:1fr 1fr 1fr}
    @media(max-width:980px){.grid-3{grid-template-columns:1fr}}
    .nav{display:flex;gap:8px;flex-wrap:wrap}
    .tab{padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:#0b1220;cursor:pointer}
    .tab.active{background:#121b31;border-color:#2a3958}
    .hide{display:none}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-top:1px solid rgba(255,255,255,.08)}
    thead th{position:sticky;top:0;background:#101a33}
    .mono{font-family:ui-monospace,Consolas,Menlo,monospace}
    .badge{padding:4px 8px;border-radius:8px;border:1px solid rgba(255,255,255,.15);font-weight:700;font-size:12px}
    .pill{display:inline-flex;gap:8px;align-items:center;border:1px solid var(--line);background:#0b1220;border-radius:10px;padding:8px 10px}
  </style>
</head>
<body>
  <div class="container">
    <!-- ===== Login ===== -->
    <div id="loginView" class="card" style="max-width:520px;margin:40px auto">
      <div class="row" style="gap:12px">
        <div class="logo" style="width:42px;height:42px;border-radius:12px;background:#111;border:1px solid #333;display:grid;place-items:center"><span style="font-weight:900;color:var(--accent)">HS</span></div>
        <div>
          <div class="muted" style="font-size:12px">HORMEZ</div>
          <div style="font-weight:800">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
        </div>
      </div>
      <div class="muted" style="margin-top:10px">Ø§Ø¯Ø®Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„ØªÙŠ Ù…Ù†Ø­ØªÙ‡Ø§ Ù„Ù„Ø¹Ù…ÙŠÙ„.</div>
      <div class="grid" style="margin-top:10px">
        <div>
          <div class="muted">Ø§Ù„Ø­Ø³Ø§Ø¨ (username)</div>
          <input id="u" class="input" placeholder="Ù…Ø«Ø§Ù„: alkendi" />
        </div>
        <div>
          <div class="muted">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</div>
          <input id="p" class="input" type="password" placeholder="â€¢â€¢â€¢â€¢" />
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <button id="loginBtn" class="btn btn-cta">Ø¯Ø®ÙˆÙ„</button>
      </div>
      <div id="loginErr" class="muted" style="color:#fca5a5;margin-top:8px;display:none">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©</div>
      <div class="muted" style="margin-top:10px;font-size:12px">* Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§ØªØŒ Ø¹Ø¯Ù‘Ù„ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© (CLIENTS)</div>
    </div>

    <!-- ===== App ===== -->
    <div id="appView" class="hide">
      <!-- App top -->
      <div class="card">
        <div class="row" style="justify-content:space-between;align-items:center">
          <div>
            <div class="muted" style="font-size:12px">Ù…Ø±Ø­Ø¨Ø§ØŒ <span id="helloName">â€”</span></div>
            <div style="font-weight:800">Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
          </div>
          <div class="row">
            <button id="logoutBtn" class="btn">Ø®Ø±ÙˆØ¬</button>
          </div>
        </div>
        <div class="grid grid-3" style="margin-top:10px">
          <div class="card">
            <div class="muted">Ø§Ù„Ø¯Ø¹ÙˆØ§Øª Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©</div>
            <div class="mono" id="kReserved" style="font-size:26px;font-weight:900">0</div>
          </div>
          <div class="card">
            <div class="muted">Ø§Ù„Ø±ØµÙŠØ¯</div>
            <div class="mono" id="kBalance" style="font-size:26px;font-weight:900">0</div>
          </div>
          <div class="card">
            <div class="muted">Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙ„ÙŠ</div>
            <div class="mono" id="kSent" style="font-size:26px;font-weight:900">0</div>
          </div>
        </div>
      </div>

      <!-- Nav -->
      <div class="card" style="margin-top:10px">
        <div class="nav">
          <button class="tab active" data-tab="home">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
          <button class="tab" data-tab="new">Ø¯Ø¹ÙˆØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
          <button class="tab" data-tab="send">Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</button>
          <button class="tab" data-tab="remind">Ø§Ù„ØªØ°ÙƒÙŠØ±</button>
          <button class="tab" data-tab="attend">Ø§Ù„Ø­Ø¶ÙˆØ±</button>
        </div>
      </div>

      <!-- Tabs Content -->
      <div id="tab-home" class="card">
        <div class="muted">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¯Ø«</div>
        <div class="row" style="margin-top:10px;align-items:flex-end">
          <div style="flex:2">
            <div class="muted">Ø§Ø³Ù… Ø§Ù„Ø­Ø¯Ø«</div>
            <input id="eventName" class="input" placeholder="Ø²ÙØ§Ù Ø³Ø¹ÙŠØ¯" />
          </div>
          <div>
            <button id="applyEvent" class="btn">ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</button>
          </div>
          <div class="pill">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©: <span id="shareUrl" class="mono" style="margin-inline-start:6px"></span></div>
        </div>
        <div class="row" style="margin-top:8px">
          <a id="openScanner" target="_blank" class="btn">ğŸ” Ø§Ù„Ù…Ø§Ø³Ø­</a>
          <a id="openDashboard" target="_blank" class="btn">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</a>
          <a id="openMerge" target="_blank" class="btn">ğŸ§© Ø¯Ù…Ø¬ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</a>
        </div>
      </div>

      <div id="tab-new" class="card hide">
        <div class="muted">Ø¥Ù†Ø´Ø§Ø¡ Ø¯Ø¹ÙˆØ© Ø¬Ø¯ÙŠØ¯Ø©</div>
        <div class="row" style="margin-top:10px">
          <button id="pickContactBtn" class="btn">ğŸ“‡ Ø³Ø¬Ù„ Ø§Ù„Ù‡Ø§ØªÙ</button>
          <span class="muted" style="font-size:12px">Ù‚Ø¯ Ù„Ø§ ØªØ¹Ù…Ù„ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© (Contacts Picker)</span>
        </div>
        <div class="grid" style="margin-top:10px">
          <div>
            <div class="muted">Ø§Ù„Ø§Ø³Ù… Ù…Ù† Ø³Ø¬Ù„ Ø§Ù„Ù‡Ø§ØªÙ</div>
            <input id="phoneName" class="input" placeholder="â€”" disabled />
          </div>
          <div>
            <div class="muted">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</div>
            <input id="phoneNumber" class="input" placeholder="05xxxxxxxx" />
          </div>
        </div>
        <div class="grid" style="margin-top:10px">
          <div>
            <div class="muted">Ø§Ù„Ø§Ø³Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø¹ÙˆØ©</div>
            <input id="inviteName" class="input" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¶ÙŠÙ" />
          </div>
          <div>
            <div class="muted">Ø¹Ø¯Ø¯ Ø§Ù„ÙƒØ±ÙˆØª Ù„Ù„Ù…Ø±Ø§ÙÙ‚ÙŠÙ†</div>
            <input id="companions" class="input" type="number" min="1" value="1" />
          </div>
        </div>
        <div style="margin-top:10px">
          <div class="muted">Ù†Øµ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨</div>
          <textarea id="waMsg" rows="5" class="input" placeholder="Ù…Ø±Ø­Ø¨Ù‹Ø§ {{name}}ØŒ ÙŠØ³Ø¹Ø¯Ù†Ø§ Ø¯Ø¹ÙˆØªÙƒ Ù„Ø­Ø¶ÙˆØ± {{event}}. Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ø¹ÙˆØ§Øª: {{count}}."></textarea>
        </div>
        <div class="row" style="margin-top:10px">
          <button id="sendNowBtn" class="btn btn-cta">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¢Ù† (WhatsApp Web)</button>
          <button id="shareBtn" class="btn">ÙØªØ­ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©</button>
        </div>
      </div>

      <div id="tab-send" class="card hide">
        <div class="muted">Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</div>
        <div style="margin-top:8px">
          <textarea id="bulkArea" rows="6" class="input" placeholder="name, phone, count\nAli, 0551234567, 2"></textarea>
        </div>
        <div class="row" style="margin-top:8px">
          <button id="bulkParseBtn" class="btn">Ø¥Ø¶Ø§ÙØ©</button>
          <button id="bulkClearBtn" class="btn">Ù…Ø³Ø­</button>
        </div>
        <div style="max-height:40vh;overflow:auto;margin-top:8px">
          <table>
            <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø±Ù‚Ù…</th><th>Ø§Ù„Ø¹Ø¯Ø¯</th><th>Ø¥Ø±Ø³Ø§Ù„</th></tr></thead>
            <tbody id="bulkBody"></tbody>
          </table>
        </div>
        <div class="row" style="margin-top:8px">
          <button id="bulkSendBtn" class="btn btn-cta">Ø¥Ø±Ø³Ø§Ù„ Ø¬Ù…Ø§Ø¹ÙŠ (ÙŠÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙŠØ¨)</button>
        </div>
      </div>

      <div id="tab-remind" class="card hide">
        <div class="muted">Ø§Ù„ØªØ°ÙƒÙŠØ±</div>
        <div style="margin-top:6px">Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© ØªØ°ÙƒÙŠØ± Ù‚ØµÙŠØ±Ø© ÙˆØ³ÙŠØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙŠØ¨ Ù„ÙƒÙ„ Ù…Ø®ØªØ§Ø±.</div>
        <div style="margin-top:6px"><textarea id="remMsg" rows="4" class="input" placeholder="ØªØ°ÙƒÙŠØ± Ø¨Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© ØºØ¯Ù‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø© ..."></textarea></div>
        <div class="row" style="margin-top:8px">
          <button id="remPreviewBtn" class="btn">Ù…Ø¹Ø§ÙŠÙ†Ø© 5</button>
          <button id="remSendBtn" class="btn btn-cta">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª</button>
        </div>
      </div>

      <div id="tab-attend" class="card hide">
        <div class="muted">Ø§Ù„Ø­Ø¶ÙˆØ±</div>
        <div style="margin-top:6px" class="row">
          <a id="attDash" target="_blank" class="btn">ğŸ“Š ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</a>
          <a id="attScanner" target="_blank" class="btn">ğŸ” ÙØªØ­ Ø§Ù„Ù…Ø§Ø³Ø­</a>
        </div>
        <div class="muted" style="margin-top:6px">ØªÙÙØªØ­ Ø§Ù„ØµÙØ­Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ø­Ø§Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</div>
      </div>
    </div>
  </div>

  <script>
    // ===== Admin: Ø¹ÙŠÙ‘Ù† Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù‡Ù†Ø§ =====
    const CLIENTS = {
      "alkendi": { password: "6666", name: "Ø§Ù„ÙƒÙ†Ø¯ÙŠ", quota: 200 },
      // Ø£Ø¶Ù Ø§Ù„Ù…Ø²ÙŠØ¯ Ø¨Ù‡ÙŠØ¦Ø©: "username": { password:"xxxx", name:"Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„", quota: Ø¹Ø¯Ø¯ Ø§Ù„Ø±ØµÙŠØ¯ }
    };

    // ===== Helpers =====
    const $=(s,root=document)=>root.querySelector(s);
    const SKEY=(u)=>`hs:client:${u}:state`;
    function loadState(u){ try{ return JSON.parse(localStorage.getItem(SKEY(u))||'{}'); }catch{return{}} }
    function saveState(u,st){ localStorage.setItem(SKEY(u), JSON.stringify(st)); }
    function toast(msg){ const t=document.createElement('div'); t.textContent=msg; t.style.position='fixed'; t.style.left='50%'; t.style.transform='translateX(-50%)'; t.style.top='12px'; t.style.background='#0b1220'; t.style.border='1px solid #334155'; t.style.padding='8px 12px'; t.style.borderRadius='10px'; t.style.zIndex='50'; document.body.appendChild(t); setTimeout(()=>t.remove(),1500); }
    function tpl(str, ctx){ return (str||'').replace(/\{\{(\w+)\}\}/g,(_,k)=> ctx[k]??''); }
    function onlyDigits(s){ return (s||'').toString().replace(/[^0-9]/g,''); }

    // ===== Session =====
    let USER=null; let STATE={sent:0,reserved:0,event:""};

    function updateKpis(){ $('#kReserved').textContent=STATE.reserved||0; const q=(USER?.quota||0); const bal=Math.max(q-(STATE.sent||0),0); $('#kBalance').textContent=bal; $('#kSent').textContent=STATE.sent||0; }

    function rebuildLinks(){ const ev=encodeURIComponent($('#eventName').value.trim()); const base=location.origin+location.pathname.replace(/[^\/]*$/,'');
      const scan=`new-scanner.html${ev?`?event=${ev}`:''}`; const dash=`new-dashboard.html${ev?`?event=${ev}`:''}`; const merge=`new-merge-qr.html${ev?`?event=${ev}`:''}`;
      $('#openScanner').href=scan; $('#openDashboard').href=dash; $('#openMerge').href=merge; $('#attDash').href=dash; $('#attScanner').href=scan; $('#shareUrl').textContent = base + `client-app.html?event=${ev}`; }

    function openWA(phone,text){ const url=`https://wa.me/${encodeURIComponent(phone)}?text=${encodeURIComponent(text)}`; window.open(url,'_blank'); }

    // ===== Login flow =====
    function tryLogin(){ const u=$('#u').value.trim(); const p=$('#p').value; const rec=CLIENTS[u]; if(!rec || rec.password!==p){ $('#loginErr').style.display='block'; return; } USER={username:u, ...rec}; STATE = {...{sent:0,reserved:0,event:""}, ...loadState(u)}; $('#helloName').textContent=USER.name; updateKpis(); $('#loginView').classList.add('hide'); $('#appView').classList.remove('hide'); const purl=new URLSearchParams(location.search); const ev=purl.get('event')||STATE.event||''; if(ev) $('#eventName').value=decodeURIComponent(ev); rebuildLinks(); }

    function logout(){ USER=null; STATE={}; sessionStorage.removeItem('hs:client:session'); location.reload(); }

    // ===== Tabs =====
    function showTab(id){ document.querySelectorAll('.tab').forEach(b=>b.classList.toggle('active', b.dataset.tab===id)); ['home','new','send','remind','attend'].forEach(t=> $('#tab-'+t).classList.toggle('hide', t!==id)); }

    // ===== New Invite =====
    async function pickContact(){ try{ if(!('contacts' in navigator) || !('select' in navigator.contacts)){ alert('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ø®ØªÙŠØ§Ø± Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„.'); return; } const sel=await navigator.contacts.select(['name','tel'],{multiple:false}); if(!sel||!sel.length) return; const c=sel[0]; const name=Array.isArray(c.name)? (c.name[0]||''): (c.name||''); const tel=Array.isArray(c.tel)? (c.tel[0]||'') : (c.tel||''); $('#phoneName').value=name; $('#phoneNumber').value=tel; if(!$('#inviteName').value) $('#inviteName').value=name; }catch(e){ alert('ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„: '+(e.message||e)); } }

    function buildPhone(){ const p=onlyDigits($('#phoneNumber').value); return p; }
    function buildMsg(){ const name=$('#inviteName').value.trim(); const count=parseInt($('#companions').value||'1',10)||1; const ev=$('#eventName').value.trim(); const tplMsg=$('#waMsg').value||'Ù…Ø±Ø­Ø¨Ù‹Ø§ {{name}}ØŒ ÙŠØ³Ø¹Ø¯Ù†Ø§ Ø¯Ø¹ÙˆØªÙƒ Ù„Ø­Ø¶ÙˆØ± {{event}}. Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ø¹ÙˆØ§Øª: {{count}}.'; return tpl(tplMsg,{name, count, event:ev}); }

    function sendNow(){ const phone=buildPhone(); if(!phone){ alert('Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­'); return;} const text=buildMsg(); openWA(phone,text); STATE.sent=(STATE.sent||0)+1; saveState(USER.username, STATE); updateKpis(); toast('ØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨'); }

    function shareOpen(){ const phone=buildPhone()||''; const text=buildMsg(); const url=`https://wa.me/${encodeURIComponent(phone)}?text=${encodeURIComponent(text)}`; window.open(url,'_blank'); }

    // ===== Bulk =====
    let BULK=[];
    function renderBulk(){ const body=$('#bulkBody'); body.innerHTML=''; BULK.forEach((r,i)=>{ const tr=document.createElement('tr'); const t1=document.createElement('td'); t1.textContent=r.name; tr.appendChild(t1); const t2=document.createElement('td'); t2.textContent=r.phone; tr.appendChild(t2); const t3=document.createElement('td'); const inp=document.createElement('input'); inp.type='number'; inp.min='1'; inp.value=r.count||1; inp.className='input'; inp.style.width='100px'; inp.onchange=()=>{ r.count=Math.max(1,parseInt(inp.value||'1',10)||1); }; t3.appendChild(inp); tr.appendChild(t3); const t4=document.createElement('td'); const b=document.createElement('button'); b.className='btn'; b.textContent='Ø¥Ø±Ø³Ø§Ù„'; b.onclick=()=>{ const msg=tpl($('#waMsg').value||'Ù…Ø±Ø­Ø¨Ù‹Ø§ {{name}}ØŒ ÙŠØ³Ø¹Ø¯Ù†Ø§ Ø¯Ø¹ÙˆØªÙƒ Ù„Ø­Ø¶ÙˆØ± {{event}}. Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ø¹ÙˆØ§Øª: {{count}}.', {name:r.name, count:r.count||1, event:$('#eventName').value.trim()}); openWA(onlyDigits(r.phone), msg); STATE.sent=(STATE.sent||0)+1; saveState(USER.username, STATE); updateKpis(); }; t4.appendChild(b); tr.appendChild(t4); body.appendChild(tr); }); }

    function bulkParse(){ const text=$('#bulkArea').value||''; const lines=text.split(/\n+/).map(s=>s.trim()).filter(Boolean); BULK = lines.map(l=>{ const parts=l.split(','); return { name:(parts[0]||'').trim(), phone:(parts[1]||'').trim(), count: parseInt((parts[2]||'1').trim(),10)||1 }; }).filter(r=>r.name && r.phone); renderBulk(); toast('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©'); }
    function bulkClear(){ BULK=[]; renderBulk(); }
    async function bulkSend(){ if(!BULK.length){ alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª'); return;} const ev=$('#eventName').value.trim(); const msgTpl=$('#waMsg').value||'Ù…Ø±Ø­Ø¨Ù‹Ø§ {{name}}ØŒ ÙŠØ³Ø¹Ø¯Ù†Ø§ Ø¯Ø¹ÙˆØªÙƒ Ù„Ø­Ø¶ÙˆØ± {{event}}. Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ø¹ÙˆØ§Øª: {{count}}.'; let opened=0; for(const r of BULK){ const msg=tpl(msgTpl,{name:r.name,count:r.count||1,event:ev}); openWA(onlyDigits(r.phone), msg); opened++; if(opened%8===0){ await new Promise(res=>setTimeout(res,800)); } STATE.sent=(STATE.sent||0)+1; } saveState(USER.username, STATE); updateKpis(); }

    // ===== Reminders =====
    function remPreview(){ const msg=$('#remMsg').value||''; const ex=BULK.slice(0,5).map(r=>`Ø¥Ù„Ù‰ ${r.name} (${r.phone}): ${msg}`).join('\n\n'); alert(ex||'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©.'); }
    async function remSend(){ const msg=$('#remMsg').value||''; if(!msg){ alert('Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ°ÙƒÙŠØ±'); return;} let opened=0; for(const r of BULK){ openWA(onlyDigits(r.phone), msg); opened++; if(opened%8===0) await new Promise(res=>setTimeout(res,800)); } toast('ØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªØ°ÙƒÙŠØ±'); }

    // ===== Wire =====
    document.addEventListener('DOMContentLoaded',()=>{
      // Login
      $('#loginBtn').addEventListener('click', tryLogin);
      $('#logoutBtn').addEventListener('click', logout);

      // Tabs
      document.querySelectorAll('.tab').forEach(b=> b.addEventListener('click', ()=> showTab(b.dataset.tab)));

      // Home links
      $('#applyEvent').addEventListener('click', ()=>{ STATE.event=$('#eventName').value.trim(); saveState(USER.username, STATE); rebuildLinks(); toast('ØªÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚'); });

      // New
      $('#pickContactBtn').addEventListener('click', pickContact);
      $('#sendNowBtn').addEventListener('click', sendNow);
      $('#shareBtn').addEventListener('click', shareOpen);

      // Bulk
      $('#bulkParseBtn').addEventListener('click', bulkParse);
      $('#bulkClearBtn').addEventListener('click', bulkClear);
      $('#bulkSendBtn').addEventListener('click', bulkSend);

      // Remind
      $('#remPreviewBtn').addEventListener('click', remPreview);
      $('#remSendBtn').addEventListener('click', remSend);

      // Deep-link event from URL
      const p=new URLSearchParams(location.search); const ev=p.get('event'); if(ev) $('#eventName').value=decodeURIComponent(ev);

      // Default tab
      showTab('home');
    });
  </script>
</body>
</html>
