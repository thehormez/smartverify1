<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مركز إرسال الدعوات اليدوي</title>
    <style>
        body { font-family: Tahoma, Arial, sans-serif; background-color: #f4f4f9; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background-color: #ffffff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        h1 { text-align: center; color: #333; margin-bottom: 30px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: right; }
        th { background-color: #5d7eaf; color: white; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        button { padding: 8px 15px; margin: 5px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; transition: background-color 0.3s; }
        .btn-qr { background-color: #4CAF50; color: white; }
        .btn-qr:hover { background-color: #45a049; }
        .btn-whatsapp { background-color: #25D366; color: white; }
        .btn-whatsapp:hover { background-color: #1DA851; }
    </style>
</head>
<body>

<div class="container">
    <h1>مركز إرسال الدعوات اليدوي (خطوتان لكل ضيف)</h1>

    <table>
        <thead>
            <tr>
                <th>اسم الضيف</th>
                <th>رقم الهاتف</th>
                <th>الحالة</th>
                <th>الإجراءات</th>
            </tr>
        </thead>
        <tbody id="guestTableBody">
            </tbody>
    </table>
</div>

<script>
    // ----------------------------------------------------------------------
    // 1. بيانات الدعوات
    // 
    // ملاحظة هامة: يجب أن تكون الروابط هنا هي الروابط 'القصيرة' التي تم إنشاؤها عبر Bitly أو Short.io
    // تأكد من أن ملفات صور الباركود موجودة في مجلد "qr_images" داخل نفس مجلد هذا الملف.
    // ----------------------------------------------------------------------
    const guests = [
        {
            id: '1001', 
            name: 'فهد السالم', 
            phone: '96650XXXXXXX', 
            status: 'Pending', 
            qrImage: 'qr-1001.png', // اسم ملف الصورة في مجلد qr_images
            shortConfirmLink: 'https://bit.ly/fahd-c', 
            shortDeclineLink: 'https://bit.ly/fahd-d'
        },
        {
            id: '1002', 
            name: 'نورة العلي', 
            phone: '96655XXXXXXX', 
            status: 'Confirmed', 
            qrImage: 'qr-1002.png',
            shortConfirmLink: 'https://bit.ly/nora-c', 
            shortDeclineLink: 'https://bit.ly/nora-d'
        },
        {
            id: '1003', 
            name: 'خالد الزهراني', 
            phone: '96656XXXXXXX', 
            status: 'Declined', 
            qrImage: 'qr-1003.png', 
            shortConfirmLink: 'https://bit.ly/khaled-c', 
            shortDeclineLink: 'https://bit.ly/khaled-d'
        }
        // أضف المزيد من الضيوف هنا...
    ];

    // ----------------------------------------------------------------------
    // 2. وظائف JavaScript الرئيسية
    // ----------------------------------------------------------------------

    /**
     * وظيفة لفتح صورة الباركود المخصصة في نافذة جديدة.
     * @param {string} imageName - اسم ملف صورة الباركود (مثلاً: qr-1001.png).
     */
    function openBarcodeImage(imageName) {
        // المسار يفترض أن الصور موجودة في مجلد فرعي باسم 'qr_images'
        const imagePath = `qr_images/${imageName}`;
        window.open(imagePath, '_blank');
    }

    /**
     * وظيفة لفتح محادثة واتساب مع رسالة مُعدَّة مسبقاً.
     * @param {string} phone - رقم هاتف الضيف (يجب أن يبدأ برمز الدولة، مثل 966).
     * @param {string} name - اسم الضيف.
     * @param {string} confirmLink - الرابط القصير لتأكيد الحضور.
     * @param {string} declineLink - الرابط القصير للاعتذار.
     */
    function sendWhatsAppMessage(phone, name, confirmLink, declineLink) {
        const message = `مرحباً ${name}،
نتشرف بدعوتك لحضور...

للتأكيد: ${confirmLink}
للاعتذار: ${declineLink}

⚠️ ملاحظة هامة: كود الدخول الخاص بك في الصورة المرفقة (يجب إرفاق الصورة يدوياً).`;

        // إنشاء رابط واتساب مع الرسالة المشفرة
        const waLink = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
        
        // فتح محادثة الواتساب في نافذة جديدة
        window.open(waLink, '_blank');
    }

    // ----------------------------------------------------------------------
    // 3. عرض البيانات في الجدول
    // ----------------------------------------------------------------------
    
    document.addEventListener('DOMContentLoaded', () => {
        const tableBody = document.getElementById('guestTableBody');
        
        guests.forEach(guest => {
            const row = tableBody.insertRow();
            
            // عمود الاسم ورقم الهاتف والحالة
            row.insertCell().textContent = guest.name;
            row.insertCell().textContent = guest.phone;
            
            const statusCell = row.insertCell();
            statusCell.textContent = guest.status;
            // يمكنك تلوين الحالة بناءً على قيمتها
            if (guest.status === 'Confirmed') {
                statusCell.style.color = '#4CAF50';
                statusCell.style.fontWeight = 'bold';
            } else if (guest.status === 'Declined') {
                statusCell.style.color = '#f44336';
            }

            // عمود الإجراءات (الأزرار)
            const actionsCell = row.insertCell();

            // زر فتح الباركود (الخطوة 1: تجهيز الصورة)
            const qrButton = document.createElement('button');
            qrButton.textContent = '1. فتح صورة الباركود';
            qrButton.className = 'btn-qr';
            qrButton.onclick = () => openBarcodeImage(guest.qrImage);
            actionsCell.appendChild(qrButton);
            
            // زر إرسال واتساب (الخطوة 2: فتح محادثة النص)
            const waButton = document.createElement('button');
            waButton.textContent = '2. إرسال واتساب (النص والروابط)';
            waButton.className = 'btn-whatsapp';
            waButton.onclick = () => sendWhatsAppMessage(
                guest.phone, 
                guest.name, 
                guest.shortConfirmLink, 
                guest.shortDeclineLink
            );
            actionsCell.appendChild(waButton);
        });
    });

</script>
</body>
</html>
