<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مركز الإرسال اليدوي (النسخة النهائية المبسطة)</title>
    <style>
        body { font-family: Tahoma, Arial, sans-serif; background-color: #f4f4f9; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background-color: #ffffff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        h1 { text-align: center; color: #333; margin-bottom: 20px; }
        h2 { border-bottom: 2px solid #ddd; padding-bottom: 10px; margin-top: 30px; color: #5d7eaf; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: center; }
        th { background-color: #5d7eaf; color: white; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        button { padding: 8px 15px; margin: 5px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; transition: background-color 0.3s; }
        .btn-qr { background-color: #00bcd4; color: white; }
        .btn-qr:hover { background-color: #0097a7; }
        .btn-whatsapp { background-color: #25D366; color: white; }
        .btn-whatsapp:hover { background-color: #1DA851; }
        textarea { width: 98%; min-height: 150px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; resize: vertical; margin-bottom: 15px; }
        .placeholder-note { color: #f44336; font-weight: bold; margin-bottom: 15px; display: block; text-align: right; }
        .data-warning { color: red; text-align: center; margin-top: 20px; font-size: 1.1em;}
    </style>
</head>
<body>

<div class="container">
    <h1>مركز الإرسال اليدوي (النسخة النهائية المبسطة)</h1>

    <h2>📄 بيانات الضيوف (يتم تعديلها مباشرة في كود JavaScript)</h2>
    <p class="data-warning">⚠️ **لتغيير قائمة الضيوف، يجب عليك تعديل المتغير `guests` في كود JavaScript مباشرةً.**</p>

    <h2>🖊️ تعديل نص رسالة الواتساب التلقائية</h2>
    <span class="placeholder-note">
        استخدم المتغيرات: <code>#{{GUEST_NAME}}#</code> (الاسم), <code>#{{COMPANIONS_COUNT}}#</code> (المرافقين), <code>{{CONFIRM_LINK}}</code> (تأكيد), <code>{{DECLINE_LINK}}</code> (اعتذار).
    </span>
    <textarea id="messageTemplate">
مرحباً #{{GUEST_NAME}}#،
نتشرف بدعوتكم لحضور... (مجموع الأفراد: #{{COMPANIONS_COUNT}}#).

للتأكيد: {{CONFIRM_LINK}}
للاعتذار: {{DECLINE_LINK}}

⚠️ ملاحظة هامة: كود الدخول الخاص بكم موجود في الصورة المرفقة.
    </textarea>

    <h2>📋 قائمة المدعوين</h2>
    <table>
        <thead>
            <tr>
                <th>اسم الضيف</th>
                <th>عدد المرافقين</th>
                <th>رقم الهاتف</th>
                <th>الحالة (افتراضية)</th>
                <th>الإجراءات</th>
            </tr>
        </thead>
        <tbody id="guestTableBody">
            </tbody>
    </table>

    <a id="hiddenDownloadLink" style="display: none;"></a>
</div>

<script>
    // ----------------------------------------------------------------------
    // 1. قائمة الضيوف المدمجة (يجب تعديلها هنا مباشرةً)
    // ----------------------------------------------------------------------
    let guests = [
        {
            id: '1001', 
            name: 'فهد السالم', 
            companions: 3, 
            phone: '96650XXXXXXX', 
            status: 'Pending', 
            qrImage: 'qr-fahad.png', // اسم ملف صورة الباركود في مجلد qr_images
            shortConfirmLink: 'https://bit.ly/fahd-c', // الرابط القصير للتأكيد
            shortDeclineLink: 'https://bit.ly/fahd-d' // الرابط القصير للاعتذار
        },
        {
            id: '1002', 
            name: 'نورة العلي', 
            companions: 1, 
            phone: '96655XXXXXXX', 
            status: 'Confirmed', 
            qrImage: 'qr-nora.png',
            shortConfirmLink: 'https://bit.ly/nora-c', 
            shortDeclineLink: 'https://bit.ly/nora-d'
        },
        {
            id: '1003', 
            name: 'خالد الزهراني', 
            companions: 0, 
            phone: '96656XXXXXXX', 
            status: 'Pending', 
            qrImage: 'qr-khaled.png', 
            shortConfirmLink: 'https://bit.ly/khaled-c', 
            shortDeclineLink: 'https://bit.ly/khaled-d'
        }
        // أضف المزيد من الضيوف هنا بنفس التنسيق...
    ];
    
    const QR_IMAGES_DIR = 'qr_images';

    // ----------------------------------------------------------------------
    // 2. وظائف الإرسال والتحميل الفردي
    // ----------------------------------------------------------------------
    
    /**
     * وظيفة لتحميل (تنزيل) صورة الباركود المخصصة مباشرة (فردي).
     * @param {string} imageName - اسم ملف صورة الباركود (مثلاً: qr-fahad.png).
     */
    function downloadBarcodeImage(imageName) {
        if (!imageName) {
            alert("لا يوجد اسم لملف الباركود لهذا الضيف.");
            return;
        }
        // المسار يفترض أن الصور موجودة في مجلد فرعي باسم 'qr_images'
        const imagePath = `${QR_IMAGES_DIR}/${imageName}`;
        const downloadLink = document.getElementById('hiddenDownloadLink');
        
        downloadLink.href = imagePath;
        downloadLink.download = imageName;
        downloadLink.click();
    }

    /**
     * وظيفة لفتح محادثة واتساب مع رسالة مُعدَّة مسبقاً (باستخدام النص القابل للتعديل).
     */
    function sendWhatsAppMessage(guest) {
        let messageText = document.getElementById('messageTemplate').value;

        // استبدال المتغيرات من حقل التعديل
        messageText = messageText.replace(/#{{GUEST_NAME}}#/g, guest.name);
        messageText = messageText.replace(/#{{COMPANIONS_COUNT}}#/g, guest.companions);
        messageText = messageText.replace(/{{CONFIRM_LINK}}/g, guest.shortConfirmLink);
        messageText = messageText.replace(/{{DECLINE_LINK}}/g, guest.shortDeclineLink);

        // إنشاء رابط الواتساب وفتحه
        const waLink = `https://wa.me/${guest.phone}?text=${encodeURIComponent(messageText)}`;
        window.open(waLink, '_blank');
    }

    // ----------------------------------------------------------------------
    // 3. وظيفة عرض الجدول (Render)
    // ----------------------------------------------------------------------
    
    function renderGuestTable() {
        const tableBody = document.getElementById('guestTableBody');
        tableBody.innerHTML = ''; // تفريغ الجدول قبل إعادة الملء
        
        guests.forEach(guest => {
            const row = tableBody.insertRow();
            
            // خلايا البيانات
            row.insertCell().textContent = guest.name;
            row.insertCell().textContent = guest.companions;
            row.insertCell().textContent = guest.phone;
            
            // الحالة
            const statusCell = row.insertCell();
            statusCell.textContent = guest.status;
            if (guest.status === 'Confirmed') {
                statusCell.style.color = '#4CAF50';
                statusCell.style.fontWeight = 'bold';
            } else if (guest.status === 'Declined') {
                statusCell.style.color = '#f44336';
            }

            // عمود الإجراءات (الأزرار)
            const actionsCell = row.insertCell();

            // زر تحميل الباركود (فردي)
            const qrButton = document.createElement('button');
            qrButton.textContent = '💾 تحميل الباركود';
            qrButton.className = 'btn-qr';
            qrButton.onclick = () => downloadBarcodeImage(guest.qrImage);
            actionsCell.appendChild(qrButton);
            
            // زر إرسال واتساب
            const waButton = document.createElement('button');
            waButton.textContent = '💬 إرسال واتساب';
            waButton.className = 'btn-whatsapp';
            waButton.onclick = () => sendWhatsAppMessage(guest);
            actionsCell.appendChild(waButton);
        });
    }

    // عرض الجدول عند تحميل الصفحة لأول مرة
    document.addEventListener('DOMContentLoaded', renderGuestTable);
</script>
</body>
</html>
